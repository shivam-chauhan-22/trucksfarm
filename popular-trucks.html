<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Popular Trucks - TrucksFarm</title>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css">
    <!-- PapaParse for CSV parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
</head>
<body>
    <header>
        <div class="container flex justify-between items-center">
            <div class="logo">
                <img src="https://via.placeholder.com/150x50?text=TrucksFarm" alt="TrucksFarm Logo">
            </div>
            <nav class="nav">
                <a href="index.html">Home</a>
                <a href="popular-trucks.html">Popular Trucks</a>
                <a href="index.html#categories">Categories</a>
                <a href="index.html#contact">Contact</a>
            </nav>
        </div>
    </header>

    <main class="container">
        <h1>Popular Trucks in India</h1>
        <section class="filters">
            <div class="filter-group">
                <label>Brand:</label>
                <select id="brandFilter" class="form-select">
                    <option value="">All</option>
                </select>
            </div>
            <div class="filter-group">
                <label>Fuel Type:</label>
                <select id="fuelFilter" class="form-select">
                    <option value="">All</option>
                </select>
            </div>
            <div class="filter-group">
                <label>GVW Range (kg):</label>
                <input type="number" id="minGVW" placeholder="Min" class="form-control">
                <input type="number" id="maxGVW" placeholder="Max" class="form-control">
            </div>
            <div class="filter-group">
                <label>Sort By:</label>
                <select id="sortBy" class="form-select">
                    <option value="">None</option>
                    <option value="power-hp">Power (High to Low)</option>
                    <option value="gross-vehicle-weight-kg">GVW (High to Low)</option>
                </select>
            </div>
            <div class="filter-group">
                <button id="applyFilters" class="btn">Apply Filters</button>
            </div>
        </section>

        <section id="truckGrid" class="truck-grid"></section>

        <nav class="pagination">
            <ul id="pagination" class="pagination-list"></ul>
        </nav>
    </main>

    <footer>
        <p>&copy; 2025 TrucksFarm.com. All rights reserved.</p>
        <p>Visit our partners: <a href="https://example.com">example.com</a> | <a href="https://example.com">https://example.com</a></p>
    </footer>

    <!-- Back to Top Button -->
    <button id="backToTop" class="back-to-top">â†‘ Top</button>

    <script>
        let allData = [];
        let filteredData = [];
        const itemsPerPage = 10;
        let currentPage = 1;
        const maxPageNumbers = 4;

        // Handle query parameters
        const urlParams = new URLSearchParams(window.location.search);
        const fuelParam = urlParams.get('fuel');
        const brandParam = urlParams.get('brand');

        // Load CSV
        Papa.parse('TATACSVFILE2.csv', {
            download: true,
            header: true,
            complete: function(results) {
                allData = results.data.filter(row => row.modelName);
                filteredData = [...allData];

                // Apply query parameters
                if (fuelParam) document.getElementById('fuelFilter').value = fuelParam;
                if (brandParam) document.getElementById('brandFilter').value = brandParam;
                applyFilters();
                populateFilters();
                displayTrucks();
            }
        });

        // Populate filter dropdowns
        function populateFilters() {
            const brands = [...new Set(allData.map(row => row.brandSlug))];
            const fuels = [...new Set(allData.map(row => row['fuel-type']))];

            brands.forEach(brand => {
                document.getElementById('brandFilter').innerHTML += `<option value="${brand}">${brand.charAt(0).toUpperCase() + brand.slice(1)}</option>`;
            });
            fuels.forEach(fuel => {
                document.getElementById('fuelFilter').innerHTML += `<option value="${fuel}">${fuel}</option>`;
            });
        }

        // Apply filters and sort
        function applyFilters() {
            const selectedBrand = document.getElementById('brandFilter').value;
            const selectedFuel = document.getElementById('fuelFilter').value;
            const minGVW = parseInt(document.getElementById('minGVW').value) || 0;
            const maxGVW = parseInt(document.getElementById('maxGVW').value) || Infinity;
            const sortBy = document.getElementById('sortBy').value;

            filteredData = allData.filter(row => {
                const gvw = parseInt(row['gross-vehicle-weight-kg']) || 0;
                return (!selectedBrand || row.brandSlug === selectedBrand) &&
                       (!selectedFuel || row['fuel-type'] === selectedFuel) &&
                       (gvw >= minGVW && gvw <= maxGVW);
            });

            if (sortBy) {
                filteredData.sort((a, b) => parseInt(b[sortBy]) - parseInt(a[sortBy]));
            }
        }

        document.getElementById('applyFilters').addEventListener('click', () => {
            applyFilters();
            currentPage = 1;
            displayTrucks();
        });

        // Display trucks in grid
        function displayTrucks() {
            const grid = document.getElementById('truckGrid');
            grid.innerHTML = '';

            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageData = filteredData.slice(start, end);

            pageData.forEach(truck => {
                const card = `
                    <div class="truck-card">
                        <img src="https://via.placeholder.com/300x150?text=${truck.modelName}" alt="${truck.modelName}">
                        <div>
                            <h5>${truck.modelName} (${truck.name})</h5>
                            <p>Brand: ${truck.brandSlug}</p>
                            <p>Fuel: ${truck['fuel-type']}</p>
                            <p>Power: ${truck['power-hp']} HP</p>
                            <p>GVW: ${truck['gross-vehicle-weight-kg']} kg</p>
                            <p>Engine: ${truck['engine-capacity-cc']} cc</p>
                        </div>
                    </div>
                `;
                grid.innerHTML += card;
            });

            setupPagination();
        }

        // Setup pagination with limited numbers and Previous/Next
        function setupPagination() {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            const pageCount = Math.ceil(filteredData.length / itemsPerPage);

            // Previous button
            if (currentPage > 1) {
                const prevLi = document.createElement('li');
                prevLi.className = 'pagination-btn';
                prevLi.innerHTML = `<a href="#">Previous</a>`;
                prevLi.addEventListener('click', (e) => {
                    e.preventDefault();
                    currentPage--;
                    displayTrucks();
                });
                pagination.appendChild(prevLi);
            }

            // Page numbers (show 3-4 at a time)
            let startPage = Math.max(1, currentPage - Math.floor(maxPageNumbers / 2));
            let endPage = Math.min(pageCount, startPage + maxPageNumbers - 1);
            if (endPage - startPage < maxPageNumbers - 1) {
                startPage = Math.max(1, endPage - maxPageNumbers + 1);
            }

            for (let i = startPage; i <= endPage; i++) {
                const li = document.createElement('li');
                li.className = `pagination-btn ${i === currentPage ? 'active' : ''}`;
                li.innerHTML = `<a href="#">${i}</a>`;
                li.addEventListener('click', (e) => {
                    e.preventDefault();
                    currentPage = i;
                    displayTrucks();
                });
                pagination.appendChild(li);
            }

            // Next button
            if (currentPage < pageCount) {
                const nextLi = document.createElement('li');
                nextLi.className = 'pagination-btn';
                nextLi.innerHTML = `<a href="#">Next</a>`;
                nextLi.addEventListener('click', (e) => {
                    e.preventDefault();
                    currentPage++;
                    displayTrucks();
                });
                pagination.appendChild(nextLi);
            }
        }

        // Smooth Scroll for Anchor Links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // Back to Top Button
        const backToTop = document.getElementById('backToTop');
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                backToTop.classList.add('visible');
            } else {
                backToTop.classList.remove('visible');
            }
        });

        backToTop.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });
    </script>